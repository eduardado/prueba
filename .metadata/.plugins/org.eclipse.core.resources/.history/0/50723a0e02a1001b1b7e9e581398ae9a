package com.comerzzia.bookerzzia.backoffice.web.lenguajes.acciones;

import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpSession;

import com.comerzzia.bookerzzia.backoffice.services.lenguajes.ParametrosBuscarLenguajesBean;
import com.comerzzia.bookerzzia.backoffice.web.tags.CustomWebKeys;
import com.comerzzia.core.servicios.permisos.PermisosEfectivosAccionBean;
import com.comerzzia.core.servicios.sesion.DatosSesionBean;
import com.comerzzia.taglib.WebKeys;
import com.comerzzia.web.base.Accion;
import com.comerzzia.web.base.Vista;

// este servlet se ejecuta al entrar en la pantalla por primera vez
public class EjecutarAccion extends Accion {

	@Override
	public Vista ejecutar(HttpServletRequest request) { // recibe un request y devuelve una vista

		// obtiene los datos de la sesión
		HttpSession httpSession = request.getSession(); // a partir de un HttpServletRequest se obtiene la sesión
		DatosSesionBean datosSesion = (DatosSesionBean) httpSession.getAttribute(WebKeys.DATOS_SESION);

		// Comprueba los permisos de la acción
		PermisosEfectivosAccionBean permisos = datosSesion.getPermisos(this.getAccionMenu()); // TODO para qué este
		                                                                                      // this?
		if (!permisos.isPuedeEjecutar()) { // si el permiso no se puede ejecutar
			return SIN_PERMISO; // si no se puede ejecutar devuelve la vista llamada SIN_PERMISO
		}

		// Inicializa parámetros de búsqueda
		ParametrosBuscarLenguajesBean param = (ParametrosBuscarLenguajesBean) httpSession.getAttribute(CustomWebKeys.PARAM_BUSCAR_LENGUAJES);
		if (param == null) { // si no hay parámetros de búsqueda instanciados
			param = new ParametrosBuscarLenguajesBean(); // se instancia el objeto
			httpSession.setAttribute(CustomWebKeys.PARAM_BUSCAR_LENGUAJES, param); // se le pasa al mapa de la sesión
		}
		else {
			param.setNumPagina(0); // si está iniciado ya en la sesión se pone cero páginas (no se mostrará nada)
		}
		
		

		return getControlador().getAccion("buscar").ejecutar(request); // TODO acción buscar... lo que hace es buscar pero se devuelven cero páginas, y así se carga la vista
		// si no hay permisos para cargar la vista se muestra la vista SIN_PERMISO que estará definida en el jsp
	}

	@Override
	public String getNombre() {
		// TODO Auto-generated method stub
		return null;
	}

}
